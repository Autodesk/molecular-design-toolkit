moldesign_requirements:
  requires:
    - python_deploy_base
  build: |
    RUN conda install -qy -c omnia parmed biopython

moldesign:
 description: Base installation of the MDT library. Built from the current directory.
 requires:
  - notebook
  - moldesign_requirements
 build_directory: ../
 build: |
  COPY . /opt/molecular-design-toolkit
  RUN cd /opt/molecular-design-toolkit \
   && pip install -r requirements.txt \
   && pip install -e .

moldesign_notebook:
 description: A production-ready, fully outfitted jupyter server container
 requires:
  - chem_python
  - notebook
  - moldesign
 build: |
  RUN pip install nbmolviz # == 0.7.0
  RUN python -m moldesign copyexamples
  RUN jupyter nbextension enable --python --sys-prefix widgetsnbextension \
   && jupyter nbextension enable --python --sys-prefix nbmolviz

moldesign_complete:
  description: An image with moldesign and all python dependencies
  requires:
   - moldesign_notebook
  build: |
   ENTRYPOINT []
   CMD ''

moldesign_standalone:
  description: |
       Complete image INCLUDING binary dependencies, which run in container
       subprocesses (i.e., NOT with CCC)
  requires:
     - moldesign_complete
     - nwchem
     - ambertools
     - opsin
  build: |
    RUN mkdir -p ~/.moldesign \
     && echo "engine_type: subprocess" > ~/.moldesign/moldesign.yml

moldesign_minimal:
   description: |
      Same as moldesign_notebook, but *without* any dependencies (OpenBabel, OpenMM etc.).
      Used for testing remote execution environment
   requires:
    - notebook
    - moldesign
   build: |
     ENTRYPOINT []
     CMD ''