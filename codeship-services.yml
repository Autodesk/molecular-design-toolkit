coverage-pusher:
  add_docker: true
  build: &basebuild
    context: .
    dockerfile: ./deployment/build-env.dockerfile
  cached: false
  encrypted_env_file: ./deployment/test-tokens.crypt
  environment: &buildenv
    REPO: 'docker.io/autodesk/moldesign:'
  volumes: 
    - './tmp/reports:/opt/reports'
  working_dir: /opt/molecular-design-toolkit

image-builder:
  add_docker: true
  build: *basebuild
  cached: true
  environment: *buildenv
  working_dir: /opt/molecular-design-toolkit

publisher:
  add_docker: true
  build: *basebuild
  cached: false
  encrypted_env_file: ./deployment/deploy-tokens.crypt
  environment: *buildenv
  volumes:
    - './tmp/dist:/opt/dist'
  working_dir: /opt/molecular-design-toolkit

test-moldesign-complete:
  add_docker: true
  build:
    args:
      baseimage: moldesign_complete
    context: ./
    dockerfile: deployment/test-env.dockerfile
  encrypted_env_file: ./deployment/test-tokens.crypt
  environment:
    OPENMM_CPU_THREADS: 1
    PYVERSION: 3
    REPO: 'docker.io/autodesk/moldesign:'
    TESTENV: complete
  volumes: &testvol
   - './tmp/reports:/opt/reports'
  working_dir: /opt/molecular-design-toolkit/

test-moldesign-complete-py2:
  add_docker: true
  build:
    args:
      baseimage: moldesign_complete_py2
    context: ./
    dockerfile: deployment/test-env.dockerfile
  encrypted_env_file: ./deployment/test-tokens.crypt
  environment:
    OPENMM_CPU_THREADS: 1
    PYVERSION: 2
    REPO: 'docker.io/autodesk/moldesign:'
    TESTENV: complete
  volumes: *testvol
  working_dir: /opt/molecular-design-toolkit/

test-moldesign-minimal:
  add_docker: true
  build:
    args:
      baseimage: moldesign_minimal
    context: ./
    dockerfile: deployment/test-env.dockerfile
  encrypted_env_file: ./deployment/test-tokens.crypt
  environment:
    OPENMM_CPU_THREADS: 1
    PYVERSION: 3
    REPO: 'docker.io/autodesk/moldesign:'
    TESTENV: minimal
  volumes: *testvol
  working_dir: /opt/molecular-design-toolkit/

test-moldesign-minimal-py2:
  add_docker: true
  build:
    args: 
      baseimage: moldesign_minimal_py2
    context: ./
    dockerfile: deployment/test-env.dockerfile
  encrypted_env_file: ./deployment/test-tokens.crypt
  environment:
    OPENMM_CPU_THREADS: 1
    PYVERSION: 2
    REPO: 'docker.io/autodesk/moldesign:'
    TESTENV: minimal
  volumes: *testvol
  working_dir: /opt/molecular-design-toolkit/
