build_base: &build-base
  build:
    context: .
    dockerfile: ./deployment/build-env.dockerfile
  volumes:
    - ./tmp/dist:/opt/molecular-design-toolkit/dist
  add_docker: true
  cached: true
  environment:
    chemdocker_tag: 0.9.0rc5

python_builder:
  <<: *build-base
  working_dir: /opt/molecular-design-toolkit

image_builder:
  <<: *build-base
  working_dir: /opt/molecular-design-toolkit/DockerMakefiles


publisher:
  <<: *build-base
  working_dir: /opt/molecular-design-toolkit
  encrypted_env_file: deployment/tokens.crypt
  add_docker: true
  working_dir: /opt/molecular-design-toolkit
  volumes:
  - ./tmp/reports:/opt/reports


test_base: &test-base
  image: dummy
  working_dir: /opt/molecular-design-toolkit/
  add_docker: true
  volumes:
    - ./tmp/reports:/opt/reports


test_moldesign_minimal:
  <<: *test-base
  image: moldesign_minimal:dev
  environment:
    TESTENV: minimal
    PYVERSION: 3
    OPENMM_CPU_THREADS: 1


test_moldesign_minimal_py2:
  <<: *test-base
  image: moldesign_minimal_py2:dev
  environment:
    TESTENV: minimal
    PYVERSION: 2
    OPENMM_CPU_THREADS: 1


test_moldesign_complete:
  <<: *test-base
  image: moldesign_complete:dev
  environment:
    TESTENV: complete
    PYVERSION: 3
    OPENMM_CPU_THREADS: 1


test_moldesign_complete_py2:
  <<: *test-base
  image: moldesign_complete_py2:dev
  environment:
    TESTENV: complete
    PYVERSION: 2
    OPENMM_CPU_THREADS: 1

