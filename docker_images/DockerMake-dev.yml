_SOURCES_:
 - DockerMake.yml

# This file is a hack to quickly build a docker image with the current dev version. A better option
# is to mount it into the container, but that's not really supported by our remote job system

moldesign_base:
 requires:
  - python_install
 build_directory: moldesign
 build: |
  RUN mkdir -p /src/
  COPY ./molecular-design-toolkit /src/molecular-design-toolkit/
  COPY ./py-cloud-compute-cannon /src/py-cloud-compute-cannon
  COPY ./notebook-molecular-visualization /src/notebook-molecular-visualization
  RUN apt-get update && apt-get install -y curl python-matplotlib \
   && curl -sL https://deb.nodesource.com/setup_6.x | bash - \
   && apt-get install -y nodejs gcc python-dev \
   && npm config set unsafe-perm=true &&echo "this a hack for node not liking to run as root ..." \
   && cd /src/ && pip install \
         ./py-cloud-compute-cannon \
         ./notebook-molecular-visualization \
         ./molecular-design-toolkit \
   && apt-get -y remove --purge npm nodejs gcc python-dev \
   && apt-get -y autoremove --purge \
   && apt-get -y clean


moldesign:
 requires:
  - moldesign_base
 build_directory: ../moldesign
 build: |
  ADD . /opt/moldesign
